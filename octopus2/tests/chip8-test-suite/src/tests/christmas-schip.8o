# Christmas greetings from Timendus!
# A little program that draws Christmas trees using Sierpinski triangles
# December 2022

:alias pointX1 v4
:alias pointY1 v5
:alias pointX2 v6
:alias pointY2 v7
:alias pointX3 v8
:alias pointY3 v9

: main
	hires

	# Draw background
	v0 := 0
	v1 := 0
	v2 := 16
	i := background
	loop
		sprite v0 v1 0
		i += v2
		i += v2
		v0 += v2
		if v0 == 128 begin
			v0 := 0
			v1 += v2
		end
		if v1 != 64 then
	again
	
	# Pick starting points for the chaos games
	pointX1 := 64
	pointY1 := 1
	pointX2 := 28
	pointY2 := 1
	pointX3 := 104
	pointY3 := 1
	
	loop
		#### Tree 1 ####

		# Pick a random vertex of the triangle
		i := triangle1
		pick-vertex
		
		# Move the current point to the average between it and the chosen vertex
		v2 := pointX1
		average
		pointX1 := v0
		v0 := v1
		v2 := pointY1
		average
		pointY1 := v0
		
		# Draw the new point
		i := point
		sprite pointX1 pointY1 1
		if vF != 0 then sprite pointX1 pointY1 1
		
		#### Tree 2 ####

		# Pick a random vertex of the triangle
		i := triangle2
		pick-vertex
		
		# Move the current point to the average between it and the chosen vertex
		v2 := pointX2
		average
		pointX2 := v0
		v0 := v1
		v2 := pointY2
		average
		pointY2 := v0
		
		# Draw the new point
		i := point
		sprite pointX2 pointY2 1
		if vF != 0 then sprite pointX2 pointY2 1
		
		#### Tree 3 ####

		# Pick a random vertex of the triangle
		i := triangle3
		pick-vertex
		
		# Move the current point to the average between it and the chosen vertex
		v2 := pointX3
		average
		pointX3 := v0
		v0 := v1
		v2 := pointY3
		average
		pointY3 := v0
		
		# Draw the new point
		i := point
		sprite pointX3 pointY3 1
		if vF != 0 then sprite pointX3 pointY3 1
	again
	
# Add a random value of 0, 2 or 4 to i and load v0, v1
: pick-vertex
	v2 := 6
	loop
		v2 := random 0b00000110
		if v2 == 6 then
	again
	i += v2
	load v1
	return
	
# Given v0 and v2, return the average in v0
: average
	if v0 > v2 begin
		vF := v0
		v0 := v2
		v2 := vF
	end
	v2 -= v0
	v2 >>= v2
	v0 += v2
	return

: triangle1
	64 1
	48 42
	80 42

: triangle2
	28 1
	14 34
	42 34

: triangle3
	104 1
	90  36
	118 36

: point
	0b10000000

: background
	# Sprite 1 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x00

	# Sprite 2 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x10 0x80 0x10
	0x00 0x18 0x00 0x5c 0x00 0x38 0x00 0x18 0x00 0x1b 0x00 0x1c 0x00 0x18 0x01 0x98

	# Sprite 3 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x10 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 4 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x20 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x02 0x00 0x01 0x00 0x01 0x00 0x09 0x00 0x0f 0x00 0x01 0x00 0x01

	# Sprite 5 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x80 0x80 0x00 0x80 0x00
	0x80 0x00 0xb0 0x00 0xe0 0x00 0xc0 0x00 0x80 0x00 0x80 0x00 0x80 0x02 0x84 0x00

	# Sprite 6 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x04 0x00 0x00 0x00 0x00 0x00
	0x00 0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 7 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x80 0x00 0x80 0x01 0x80 0x03 0xa0 0x01 0xc0 0x01 0x80 0x0d 0x80 0x03 0x80

	# Sprite 8 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x80 0x00 0x00 0x04 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 9 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x00 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 10 (1 layer, 32 bytes per layer)
	0x00 0x58 0x00 0x38 0x00 0x18 0x00 0x1c 0x00 0x1d 0x02 0x1e 0x01 0x9c 0x00 0x5c
	0x00 0x3c 0x00 0x1c 0x0c 0x3c 0x06 0x3d 0x03 0x3f 0x00 0xfe 0x00 0x7c 0x80 0x3c

	# Sprite 11 (1 layer, 32 bytes per layer)
	0x00 0x40 0x00 0x00 0x00 0x00 0xc0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x10 0x00 0x20 0x00 0x40 0x00 0x80 0x00 0x00 0x00 0x00 0x00 0x06 0x00 0x18 0x00

	# Sprite 12 (1 layer, 32 bytes per layer)
	0x00 0x01 0x00 0x01 0x02 0x21 0x00 0x11 0x00 0x3f 0x00 0x01 0x00 0x01 0x00 0x01
	0x01 0xa1 0x00 0x93 0x00 0x73 0x00 0x13 0x00 0x1f 0x00 0x03 0x00 0x03 0x04 0x03

	# Sprite 13 (1 layer, 32 bytes per layer)
	0x98 0x00 0xa0 0x00 0xc0 0x00 0xc0 0x00 0xc8 0x00 0xd0 0x00 0xe1 0x00 0xc2 0x00
	0xc4 0x40 0xcf 0x80 0xd1 0x00 0xe0 0x00 0xc0 0x00 0xc0 0x00 0xc1 0xc0 0xc1 0x00

	# Sprite 14 (1 layer, 32 bytes per layer)
	0x02 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 15 (1 layer, 32 bytes per layer)
	0x01 0x80 0x01 0x98 0x01 0xa0 0x01 0xc0 0x01 0x80 0x33 0x80 0x0b 0x80 0x07 0x84
	0x03 0x98 0x03 0xa0 0x83 0xc0 0x43 0x80 0x23 0xc3 0x1b 0xc6 0x0f 0xcc 0x07 0xf0

	# Sprite 16 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x20 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 17 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 18 (1 layer, 32 bytes per layer)
	0x73 0x3c 0x0d 0xff 0x00 0x3c 0x00 0x3c 0x00 0x3c 0x00 0x7e 0x01 0xff 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 19 (1 layer, 32 bytes per layer)
	0xf0 0x00 0xc0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x80 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 20 (1 layer, 32 bytes per layer)
	0x02 0x03 0x03 0xd3 0x00 0x2f 0x00 0x03 0x00 0x03 0x00 0x03 0x1a 0x7f 0x0f 0xff
	0x00 0x03 0x00 0x03 0x00 0x03 0x00 0x03 0x00 0x03 0x00 0x07 0x00 0x1f 0x00 0x7f

	# Sprite 21 (1 layer, 32 bytes per layer)
	0xc2 0x00 0xdc 0x00 0xf0 0x20 0xc0 0xc0 0xc1 0x80 0xc1 0x00 0xc7 0xfc 0xdf 0x00
	0xf0 0x00 0xc0 0x00 0xc0 0x00 0xc0 0x00 0xc0 0x00 0xe0 0x00 0xf8 0x00 0xfe 0x00

	# Sprite 22 (1 layer, 32 bytes per layer)
	0x00 0x06 0x00 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 23 (1 layer, 32 bytes per layer)
	0x03 0xe0 0x83 0xc0 0xf3 0xcc 0x3f 0xfb 0x03 0xc0 0x03 0xc0 0x03 0xc0 0x07 0xe0
	0x1f 0xf8 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 24 (1 layer, 32 bytes per layer)
	0x00 0x00 0x10 0x00 0xe0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00

	# Sprite 25 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x1e 0x70 0x1f 0xf8 0x1b 0xd8 0x19 0x99 0x19 0x9b 0x19 0x9b
	0x19 0x9b 0x18 0x1b 0x18 0x1b 0x18 0x1b 0x18 0x19 0x10 0x08 0x00 0x00 0x00 0x00

	# Sprite 26 (1 layer, 32 bytes per layer)
	0xce 0x61 0xac 0x80 0xce 0x60 0x00 0x00 0xf0 0x99 0xf9 0xbb 0x9d 0xe3 0x0d 0xc3
	0xfd 0x83 0xf9 0x83 0x01 0x83 0x81 0x83 0xf9 0x83 0xfd 0x02 0x00 0x00 0x00 0x00

	# Sprite 27 (1 layer, 32 bytes per layer)
	0x9d 0xb0 0x94 0x90 0xdc 0xd8 0x00 0x00 0x32 0x08 0x76 0x18 0xc6 0x18 0x87 0x18
	0x03 0xf8 0x01 0xf8 0x00 0x18 0x00 0x38 0x03 0xf0 0x07 0xe0 0x00 0x00 0x00 0x00

	# Sprite 28 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x0f 0x88 0x1f 0xd8 0x38 0x18 0x30 0x18 0x30 0x1f 0x30 0x1f
	0x30 0x18 0x30 0x18 0x30 0x18 0x38 0x18 0x1f 0x98 0x0f 0xc8 0x00 0x00 0x00 0x00

	# Sprite 29 (1 layer, 32 bytes per layer)
	0x00 0x00 0x00 0x00 0x00 0x18 0x00 0x18 0x04 0xc0 0x0d 0xc1 0x8f 0x1b 0xce 0x1b
	0xec 0x19 0x6c 0x18 0x6c 0x18 0x6c 0x18 0x6c 0x19 0x28 0x1b 0x00 0x00 0x00 0x00

	# Sprite 30 (1 layer, 32 bytes per layer)
	0x00 0xeb 0x00 0x4b 0x02 0x4a 0x06 0x00 0xe6 0x1e 0xf6 0x1f 0x87 0x9b 0x87 0x99
	0xc6 0x19 0xe6 0x19 0x76 0x18 0x77 0x18 0xe3 0x98 0xc1 0xd0 0x00 0x00 0x00 0x00

	# Sprite 31 (1 layer, 32 bytes per layer)
	0xbb 0x32 0xb2 0xaa 0xba 0xb1 0x00 0x00 0x70 0xfc 0xf9 0xfc 0xdb 0x8d 0x9b 0x0d
	0x9b 0x0c 0x9b 0x0c 0x1b 0x0c 0x1b 0x8c 0x19 0xfc 0x08 0xfd 0x00 0x00 0x00 0x00

	# Sprite 32 (1 layer, 32 bytes per layer)
	0x98 0x00 0x90 0x00 0xb0 0xf0 0x01 0xf8 0x71 0xf8 0xf9 0xf8 0xc0 0xf0 0xc0 0xf0
	0xe0 0xf0 0x70 0x60 0x38 0x60 0x38 0x00 0xf0 0x60 0xe0 0x60 0x00 0x00 0x00 0x00
